<!-- Voucher Popup Komponente -->
<!-- Styles für das Popup -->
<style>
  /* EXTREM WICHTIGER STYLE RESET */
  button.close-button,
  .close-button,
  .popup-overlay button,
  .popup-base button,
  [class*="close-button"],
  button[onclick*="closeNewsletterPopup"] {
    background-color: #f5f5f7 !important;
    background: #f5f5f7 !important;
    background-image: none !important;
    color: #000 !important;
    border-color: transparent !important;
  }
  
  button.close-button:hover,
  .close-button:hover,
  .popup-overlay button:hover,
  .popup-base button:hover {
    background-color: #e5e5e5 !important;
    background: #e5e5e5 !important;
  }

  /* =========================
     NEWSLETTER POPUP STYLES
     ========================= */
  .popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .popup-overlay.active {
    opacity: 1;
    pointer-events: all;
  }

  .popup-base {
    position: relative;
    background-color: white;
    border-radius: var(--radius);
    overflow: hidden;
    width: 90%;
    max-width: 700px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    display: flex;
    /* Fix for edge styling issues and white pixels */
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    /* Ensure smooth edges on mobile */
    -webkit-border-radius: var(--radius);
    -moz-border-radius: var(--radius);
    /* Force hardware acceleration for better rendering */
    will-change: transform;
    /* Clip background to prevent bleeding */
    background-clip: padding-box;
    -webkit-background-clip: padding-box;
    /* Add subtle border to mask edge issues */
    border: 2px solid white;
    /* Additional properties for better edge handling */
    isolation: isolate;
    contain: layout style paint;
    /* Force proper overflow handling */
    overflow: hidden;
  }

  .popup-graphic {
    padding: 40px 20px;
    width: 40%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    overflow: hidden;
    position: relative;
    /* Stronger background to prevent white bleeding */
    background-color: var(--imt-purple);
    background-image: linear-gradient(135deg, var(--imt-purple), #9c27b0);
    /* Force proper clipping */
    border-top-left-radius: calc(var(--radius) - 2px);
    border-bottom-left-radius: calc(var(--radius) - 2px);
    -webkit-border-top-left-radius: calc(var(--radius) - 2px);
    -webkit-border-bottom-left-radius: calc(var(--radius) - 2px);
    /* Enhanced background clipping */
    background-clip: padding-box;
    -webkit-background-clip: padding-box;
    /* Force clean edges with stronger properties */
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    /* Ensure no gaps */
    margin: -1px 0 -1px -1px;
    padding: calc(40px + 1px) 20px calc(40px + 1px) calc(20px + 1px);
  }

  .popup-graphic-1 {
    background: linear-gradient(135deg, var(--imt-purple), #9c27b0);
    /* Stronger fallback solid color */
    background-color: var(--imt-purple) !important;
  }

  /* Bounce animation for the voucher badge */
  @keyframes badgeBounce {
    0% {
      transform: translateY(-150%);
      animation-timing-function: ease-in;
    }
    25% {
      transform: translateY(10%);
      animation-timing-function: ease-out;
    }
    40% {
      transform: translateY(-20%);
      animation-timing-function: ease-in;
    }
    55% {
      transform: translateY(10%);
      animation-timing-function: ease-out;
    }
    70% {
      transform: translateY(-5%);
      animation-timing-function: ease-in;
    }
    85% {
      transform: translateY(2%);
      animation-timing-function: ease-out;
    }
    100% {
      transform: translateY(0);
    }
  }

  .voucher-badge {
    font-size: 2.2rem;
    font-weight: 700;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
    box-shadow: none;
    position: relative;
    animation: badgeBounce 1.2s forwards;
  }

  .voucher-badge-1 {
    background-color: white;
    color: var(--imt-purple);
  }

  .voucher-description {
    font-size: 1rem;
    font-weight: 400;
    color: white;
    margin: 0;
    margin-top: -10px;
    text-align: center;
    letter-spacing: 0.5px;
  }

  .popup-content {
    padding: 40px 30px;
    width: 60%;
  }

  /* Verbesserte Mobile-Styles für den Close-Button */
  .close-button {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: #f5f5f7;
    color: #000;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 16px;
    font-weight: normal;
    box-shadow: none;
    padding: 0;
    z-index: 9999;
  }

  .close-button:hover {
    background-color: #f0f0f0;
  }

  @media (max-width: 768px) {
    .popup-base {
      flex-direction: column;
      max-height: 90vh;
      overflow-y: auto;
      width: 85%;
      /* Improved border radius for mobile to prevent white pixels */
      border-radius: 16px;
      -webkit-border-radius: 16px;
      -moz-border-radius: 16px;
      /* Enhanced background clipping for mobile */
      background-clip: padding-box;
      -webkit-background-clip: padding-box;
      /* Force hardware acceleration for smoother rendering */
      transform: translate3d(0, 0, 0);
      -webkit-transform: translate3d(0, 0, 0);
      will-change: transform;
      /* Much stronger border for mobile to completely mask edge issues */
      border: 3px solid white;
      /* Additional containment for mobile */
      isolation: isolate;
      contain: layout style paint;
      /* Force proper overflow handling */
      overflow: hidden;
    }
    
    .popup-graphic {
      width: 100%;
      padding: 15px 12px;
      min-height: 135px;
      height: 135px;
      position: relative;
      text-align: center;
      /* Stronger background first */
      background-color: var(--imt-purple) !important;
      background-image: linear-gradient(135deg, var(--imt-purple), #9c27b0) !important;
      /* Fix rounded corners for mobile with proper clipping */
      border-radius: calc(16px - 3px) calc(16px - 3px) 0 0;
      -webkit-border-radius: calc(16px - 3px) calc(16px - 3px) 0 0;
      -moz-border-radius: calc(16px - 3px) calc(16px - 3px) 0 0;
      /* Enhanced gradient clipping */
      background-clip: padding-box;
      -webkit-background-clip: padding-box;
      /* Force clean rendering */
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
      /* Ensure gradient covers properly with overlap */
      background-size: 110% 110%;
      background-position: center;
      /* Much stronger overlap to eliminate gaps completely */
      margin: -5px -8px 0 -5px;
      /* Keep normal padding for proper spacing */
      padding: 20px 20px 15px 20px;
      /* Force overflow */
      overflow: hidden;
      /* Additional purple shadow to mask any remaining edges */
      box-shadow: 0 0 0 5px var(--imt-purple);
      /* Ensure it covers the full width */
      width: calc(100% + 16px);
      left: -8px;
    }
    
    .popup-content {
      width: 100%;
      padding: 20px 19px 25px 27px;
      /* Stronger white background */
      background-color: white !important;
      /* Fix rounded corners for mobile */
      border-radius: 0 0 calc(16px - 3px) calc(16px - 3px);
      -webkit-border-radius: 0 0 calc(16px - 3px) calc(16px - 3px);
      -moz-border-radius: 0 0 calc(16px - 3px) calc(16px - 3px);
      /* Enhanced background clipping */
      background-clip: padding-box;
      -webkit-background-clip: padding-box;
      /* Match the hero overlap for positioning */
      margin: 0 -8px -5px -5px;
      /* Adjusted padding to center content: fine-tuned for perfect symmetry */
      padding: 20px 19px 25px 27px;
      /* Ensure it covers the full width like hero */
      width: calc(100% + 16px);
      left: -8px;
      position: relative;
    }
    
    .popup-content h2 {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    
    .popup-content p {
      font-size: 0.9rem;
      margin-bottom: 15px;
    }
    
    .popup-graphic h3 {
      display: none !important;
    }
    
    /* Show voucher description on mobile with smaller font size */
    .voucher-description {
      display: block !important;
      font-size: 0.8rem !important;
      margin-top: -5px !important;
      margin-bottom: 5px !important;
    }
    
    /* Zeige den Voucher Badge aber kleiner auf Mobile */
    .voucher-badge {
      font-size: 1.2rem !important;
      width: 50px !important;
      height: 50px !important;
      margin-bottom: 10px !important;
      position: relative !important;
      z-index: 2 !important;
    }
    
    .newsletter-form .form-group {
      margin-bottom: 12px;
    }
    
    .newsletter-form .form-control {
      padding: 10px 12px;
      font-size: 14px;
    }
    
    .newsletter-form .cta-button {
      padding: 10px 16px;
      font-size: 0.9rem;
    }
    
    .newsletter-form small {
      font-size: 0.75rem;
    }
    
    .close-button {
      position: absolute !important;
      top: 10px !important;
      right: 10px !important;
      width: 30px !important;
      height: 30px !important;
      background-color: white !important;
      color: #000 !important;
      border-radius: 50% !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      font-size: 16px !important;
      z-index: 9999 !important;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important;
    }
  }
  
  @media (max-width: 400px) {
    .popup-base {
      width: 92%;
    }
    
    .popup-graphic {
      padding: 15px 10px;
    }
    
    .popup-content {
      padding: 15px 12px;
    }
    
    .voucher-badge {
      font-size: 1.5rem;
      width: 60px;
      height: 60px;
    }
  }

  /* Validation styles for newsletter form */
  .newsletter-form .invalid-input {
    border-color: #ff3860 !important;
    background-color: rgba(255, 56, 96, 0.05) !important;
  }

  .newsletter-form .valid-input {
    border-color: #23d160 !important;
    background-color: rgba(35, 209, 96, 0.05) !important;
  }

  /* Gradient styling for popup heading */
  .popup-content h2 {
    background: linear-gradient(90deg, #222 0%, #b0b0b0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    color: transparent;
    display: inline-block;
    font-weight: 600;
  }

  /* Ensure the newsletter submit button is always visible */
  .newsletter-form button[type="submit"],
  .newsletter-form .form-group button {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 100% !important;
    background: linear-gradient(to right, #6e45e2, #9c27b0) !important;
    color: white !important;
    padding: 14px 28px !important;
    font-size: 16px !important;
    font-weight: 500 !important;
    border: none !important;
    border-radius: 8px !important;
    cursor: pointer !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
    margin-top: 5px !important;
    margin-bottom: 5px !important;
    opacity: 1 !important;
    visibility: visible !important;
    position: relative !important;
    z-index: 10 !important;
    transition: all 0.2s ease !important;
  }
  
  /* Add hover effects for submit buttons */
  .newsletter-form button[type="submit"]:hover,
  .newsletter-form .form-group button:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 12px rgba(110, 69, 226, 0.3) !important;
    background: linear-gradient(to right, #5a37c7, #8b1fa3) !important;
  }
  
  .newsletter-form button[type="submit"] span,
  .newsletter-form .form-group button span {
    margin-left: 10px !important;
    display: inline-block !important;
    font-size: 18px !important;
  }

  /* Konfetti-Partikel Styles */
  .confetti-container {
    position: absolute;
    bottom: 330px; /* Noch höher positioniert für Desktop-Ansicht */
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 10px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.1s;
    z-index: 1;
  }
  
  .confetti-container.active {
    opacity: 1;
  }
  
  /* Anpassung für Mobile View */
  @media (max-width: 768px) {
    .confetti-container {
      /* Position in der Mitte des oberen Hero-Bereichs */
      bottom: auto;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      /* Sicherstellen, dass es über anderen Elementen liegt */
      z-index: 5;
    }
    
    /* Kleinere Konfetti für Mobile */
    .confetti {
      width: 4px;
      height: 4px;
    }
    
    .confetti.small {
      width: 4px;
      height: 4px;
    }
    
    .confetti.medium {
      width: 6px;
      height: 6px;
    }
    
    .confetti.large {
      width: 8px;
      height: 8px;
    }
  }
  
  .confetti {
    position: absolute;
    width: 6px;
    height: 6px;
    background-color: #ffffff;
    opacity: 0;
    transform-origin: center;
    left: 50%;
    bottom: 0;
  }
  
  /* Physikalischere Konfettis mit verschiedenen Größen */
  .confetti.tiny {
    width: 4px;
    height: 4px;
  }
  
  .confetti.small {
    width: 6px;
    height: 6px;
  }
  
  .confetti.medium {
    width: 8px;
    height: 8px;
  }
  
  .confetti.large {
    width: 10px;
    height: 10px;
  }
  
  .confetti.c1 { background-color: #ffeb3b; }
  .confetti.c2 { background-color: #4CAF50; }
  .confetti.c3 { background-color: #03A9F4; }
  .confetti.c4 { background-color: #E91E63; }
  .confetti.c5 { background-color: #FF9800; }
  .confetti.c6 { background-color: #9C27B0; }
  .confetti.c7 { background-color: #8BC34A; }
  .confetti.c8 { background-color: #F44336; }
  .confetti.c9 { background-color: #00BCD4; }
  .confetti.c10 { background-color: #FFEB3B; }
  
  .confetti.square { clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%); }
  .confetti.triangle { clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
  .confetti.circle { border-radius: 50%; }
  .confetti.star { clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); }
  
  /* Explosion nach rechts oben */
  @keyframes confettiTopRight {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translate(100px, -150px) rotate(720deg);
    }
  }
  
  /* Explosion nach links oben */
  @keyframes confettiTopLeft {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translate(-100px, -150px) rotate(-720deg);
    }
  }
  
  /* Explosion nach rechts */
  @keyframes confettiRight {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translate(80px, -40px) rotate(360deg);
    }
  }
  
  /* Explosion nach links */
  @keyframes confettiLeft {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translate(-80px, -40px) rotate(-360deg);
    }
  }
  
  /* Hoher Sprung */
  @keyframes confettiHigh {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translate(0, -180px) rotate(360deg);
    }
  }
  
  /* Mittlerer Sprung */
  @keyframes confettiMedium {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translate(0, -120px) rotate(360deg);
    }
  }
  
  /* Flacher Sprung */
  @keyframes confettiLow {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translate(0, -60px) rotate(180deg);
    }
  }
  
  .confetti.active.direction-topright {
    animation: confettiTopRight 1.2s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  
  .confetti.active.direction-topleft {
    animation: confettiTopLeft 1.2s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  
  .confetti.active.direction-right {
    animation: confettiRight 1s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  
  .confetti.active.direction-left {
    animation: confettiLeft 1s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  
  .confetti.active.direction-high {
    animation: confettiHigh 1.3s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  
  .confetti.active.direction-medium {
    animation: confettiMedium 1.1s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  
  .confetti.active.direction-low {
    animation: confettiLow 0.9s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  
  .confetti.delay1 { animation-delay: 0s; }
  .confetti.delay2 { animation-delay: 0.05s; }
  .confetti.delay3 { animation-delay: 0.1s; }
  .confetti.delay4 { animation-delay: 0.15s; }
  .confetti.delay5 { animation-delay: 0.2s; }
  .confetti.delay6 { animation-delay: 0.25s; }
  .confetti.delay7 { animation-delay: 0.1s; }
  .confetti.delay8 { animation-delay: 0.05s; }
  
  .confetti.speed1 { animation-duration: 0.8s; }
  .confetti.speed2 { animation-duration: 1s; }
  .confetti.speed3 { animation-duration: 1.2s; }
  .confetti.speed4 { animation-duration: 1.4s; }

  /* Konfettis mittel */
  .confetti c2 triangle delay2 speed2 medium direction-medium {
    animation: confettiRain 1.5s ease-out forwards, confettiSideways 2.5s ease-in-out infinite;
  }
  .confetti c6 square delay4 speed3 tiny direction-medium {
    animation: confettiRain 1.5s ease-out forwards, confettiSideways 2.5s ease-in-out infinite;
  }
  .confetti c10 circle delay6 speed1 small direction-medium {
    animation: confettiRain 1.5s ease-out forwards, confettiSideways 2.5s ease-in-out infinite;
  }
  
  /* Konfettis niedrig */
  .confetti c3 circle delay3 speed1 tiny direction-low {
    animation: confettiRain 1.5s ease-out forwards, confettiSideways 2.5s ease-in-out infinite;
  }
  .confetti c7 star delay5 speed2 small direction-low {
    animation: confettiRain 1.5s ease-out forwards, confettiSideways 2.5s ease-in-out infinite;
  }
  .confetti c9 triangle delay7 speed3 medium direction-low {
    animation: confettiRain 1.5s ease-out forwards, confettiSideways 2.5s ease-in-out infinite;
  }

  /* Support für .hidden Klasse */
  .hidden {
    display: none;
  }

  .newsletter-form .form-group {
    margin-bottom: 20px;
  }

  .newsletter-form .form-control {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.2s ease;
    background-color: #fff;
  }

  .newsletter-form .form-control:focus {
    border-color: var(--imt-purple);
    outline: none;
    box-shadow: 0 0 0 3px rgba(110, 69, 226, 0.1);
  }

  .newsletter-form .cta-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(to right, var(--imt-purple), #9c27b0);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    width: 100%;
  }

  .newsletter-form .cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(106, 69, 226, 0.2);
    text-decoration: none;
  }
</style>

<!-- Newsletter Popup HTML -->
<div class="popup-overlay" id="newsletter-popup">
  <!-- Hidden Netlify Form Schema -->
  <form name="newsletter-voucher-popup-en" netlify netlify-honeypot="bot-field" hidden>
    <input type="text" name="firstname" />
    <input type="text" name="lastname" />
    <input type="email" name="email" />
    <select name="country"></select>
    <input type="checkbox" name="email_consent" />
    <input type="hidden" name="form-name" value="newsletter-voucher-popup-en" />
  </form>

  <div class="popup-base">
    <button class="close-button" onclick="closeNewsletterPopup()">✕</button>
    <div class="popup-graphic popup-graphic-1">
      <div class="voucher-badge voucher-badge-1">20%</div>
      <h3>VOUCHER</h3>
      <p class="voucher-description">for all Executive Education Programmes</p>
      
      <!-- Konfetti-Container -->
      <div class="confetti-container" id="confetti-container">
        <!-- Konfettis nach oben rechts -->
        <div class="confetti c1 square delay1 speed2 small direction-topright"></div>
        <div class="confetti c4 circle delay2 speed3 medium direction-topright"></div>
        <div class="confetti c7 triangle delay3 speed1 tiny direction-topright"></div>
        <div class="confetti c10 star delay4 speed2 small direction-topright"></div>
        <div class="confetti c3 square delay5 speed4 large direction-topright"></div>
        <div class="confetti c6 triangle delay2 speed3 medium direction-topright"></div>
        
        <!-- Konfettis nach oben links -->
        <div class="confetti c2 triangle delay2 speed1 medium direction-topleft"></div>
        <div class="confetti c5 square delay3 speed3 tiny direction-topleft"></div>
        <div class="confetti c8 circle delay4 speed2 small direction-topleft"></div>
        <div class="confetti c3 star delay5 speed1 medium direction-topleft"></div>
        <div class="confetti c9 triangle delay1 speed4 large direction-topleft"></div>
        <div class="confetti c1 circle delay3 speed2 small direction-topleft"></div>
        
        <!-- Konfettis nach rechts -->
        <div class="confetti c3 square delay2 speed2 small direction-right"></div>
        <div class="confetti c6 circle delay3 speed4 tiny direction-right"></div>
        <div class="confetti c9 triangle delay5 speed1 medium direction-right"></div>
        <div class="confetti c2 star delay1 speed3 large direction-right"></div>
        <div class="confetti c5 square delay4 speed2 medium direction-right"></div>
        
        <!-- Konfettis nach links -->
        <div class="confetti c4 circle delay3 speed3 tiny direction-left"></div>
        <div class="confetti c7 square delay4 speed2 medium direction-left"></div>
        <div class="confetti c10 triangle delay6 speed1 small direction-left"></div>
        <div class="confetti c1 star delay2 speed4 large direction-left"></div>
        <div class="confetti c8 circle delay5 speed3 medium direction-left"></div>
        
        <!-- Konfettis hoch -->
        <div class="confetti c1 star delay1 speed3 small direction-high"></div>
        <div class="confetti c5 circle delay3 speed4 tiny direction-high"></div>
        <div class="confetti c9 square delay5 speed2 medium direction-high"></div>
        <div class="confetti c3 triangle delay2 speed1 large direction-high"></div>
        <div class="confetti c7 circle delay4 speed3 small direction-high"></div>
        <div class="confetti c2 star delay6 speed2 medium direction-high"></div>
        
        <!-- Konfettis mittel -->
        <div class="confetti c2 triangle delay2 speed2 medium direction-medium"></div>
        <div class="confetti c6 square delay4 speed3 tiny direction-medium"></div>
        <div class="confetti c10 circle delay6 speed1 small direction-medium"></div>
        <div class="confetti c4 star delay1 speed4 large direction-medium"></div>
        <div class="confetti c8 triangle delay3 speed2 medium direction-medium"></div>
        
        <!-- Konfettis niedrig -->
        <div class="confetti c3 circle delay3 speed1 tiny direction-low"></div>
        <div class="confetti c7 star delay5 speed2 small direction-low"></div>
        <div class="confetti c9 triangle delay7 speed3 medium direction-low"></div>
        <div class="confetti c1 square delay1 speed4 large direction-low"></div>
        <div class="confetti c5 circle delay2 speed3 tiny direction-low"></div>
      </div>
    </div>
    <div class="popup-content">
      <h2>Stay Up to Date</h2>
      <p>Get access to exclusive webinars and 20% off all Executive Education programmes.</p>
      
      <form class="newsletter-form" method="post" netlify name="newsletter-voucher-popup-en" netlify-honeypot="bot-field" data-netlify="true" action="/" novalidate>
        <p class="hidden" style="display: none;">
          <label>Don't fill this out if you're human: <input name="bot-field" /></label>
        </p>
        <input type="hidden" name="form-name" value="newsletter-voucher-popup-en">
        <div class="form-group">
          <input type="text" name="firstname" class="form-control" placeholder="First name" required>
        </div>
        <div class="form-group">
          <input type="text" name="lastname" class="form-control" placeholder="Last name" required>
        </div>
        <div class="form-group">
          <input type="email" name="email" class="form-control" placeholder="Email" required>
        </div>
        <div class="form-group">
          <div style="position: relative;">
            <select name="country" class="form-control" required style="padding-right: 40px; appearance: none; -webkit-appearance: none;">
              <option value="">Select country</option>
              <option value="AD">Andorra</option>
              <option value="AR">Argentina</option>
              <option value="AU">Australia</option>
              <option value="BH">Bahrain</option>
              <option value="BE">Belgium</option>
              <option value="BR">Brazil</option>
              <option value="BN">Brunei</option>
              <option value="CL">Chile</option>
              <option value="CN">China</option>
              <option value="DK">Denmark</option>
              <option value="DE">Germany</option>
              <option value="EE">Estonia</option>
              <option value="FI">Finland</option>
              <option value="FR">France</option>
              <option value="GI">Gibraltar</option>
              <option value="GR">Greece</option>
              <option value="HK">Hong Kong</option>
              <option value="IN">India</option>
              <option value="ID">Indonesia</option>
              <option value="IE">Ireland</option>
              <option value="IS">Iceland</option>
              <option value="IL">Israel</option>
              <option value="IT">Italy</option>
              <option value="JP">Japan</option>
              <option value="JO">Jordan</option>
              <option value="CA">Canada</option>
              <option value="CO">Colombia</option>
              <option value="HR">Croatia</option>
              <option value="QA">Qatar</option>
              <option value="KW">Kuwait</option>
              <option value="LB">Lebanon</option>
              <option value="LI">Liechtenstein</option>
              <option value="LU">Luxembourg</option>
              <option value="MO">Macau</option>
              <option value="MY">Malaysia</option>
              <option value="MT">Malta</option>
              <option value="MX">Mexico</option>
              <option value="MC">Monaco</option>
              <option value="NL">Netherlands</option>
              <option value="NZ">New Zealand</option>
              <option value="NO">Norway</option>
              <option value="OM">Oman</option>
              <option value="AT">Austria</option>
              <option value="PK">Pakistan</option>
              <option value="PA">Panama</option>
              <option value="PE">Peru</option>
              <option value="PH">Philippines</option>
              <option value="PL">Poland</option>
              <option value="PT">Portugal</option>
              <option value="PR">Puerto Rico</option>
              <option value="RO">Romania</option>
              <option value="RU">Russia</option>
              <option value="SM">San Marino</option>
              <option value="SA">Saudi Arabia</option>
              <option value="SE">Sweden</option>
              <option value="CH">Switzerland</option>
              <option value="SG">Singapore</option>
              <option value="SK">Slovakia</option>
              <option value="SI">Slovenia</option>
              <option value="ES">Spain</option>
              <option value="ZA">South Africa</option>
              <option value="KR">South Korea</option>
              <option value="TW">Taiwan</option>
              <option value="TH">Thailand</option>
              <option value="TR">Turkey</option>
              <option value="CZ">Czech Republic</option>
              <option value="UA">Ukraine</option>
              <option value="HU">Hungary</option>
              <option value="AE">United Arab Emirates</option>
              <option value="GB">United Kingdom</option>
              <option value="US">United States</option>
              <option value="VN">Vietnam</option>
              <option value="CY">Cyprus</option>
              <option value="OTHER">Other</option>
            </select>
            <div style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none;">
              <svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 1L6 6L11 1" stroke="#888888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>
        
        <!-- Email Consent Checkbox -->
        <div class="form-group" style="margin-top: 15px; margin-bottom: 15px;">
          <label style="display: flex; align-items: flex-start; gap: 8px; cursor: pointer;">
            <input type="checkbox" name="email_consent" style="margin-top: 3px;">
            <span style="font-size: 0.9rem; color: var(--color-muted);">
              I agree to receive information by email about offers from StGallen imt Business School.
            </span>
          </label>
        </div>
        
        <!-- Prominent Newsletter Button -->
        <div class="form-group" style="margin-top: 20px;">
          <button type="submit" style="width: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(to right, #6e45e2, #9c27b0); color: white; padding: 14px 28px; font-size: 16px; font-weight: 500; border: none; border-radius: 8px; text-decoration: none; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            Subscribe to newsletter now
            <span style="margin-left: 10px; display: inline-block; font-size: 18px;">→</span>
          </button>
        </div>
      </form>
      
      <!-- Erfolgsanzeige nach Formularabsendung (anfangs versteckt) -->
      <div id="newsletter-success" class="hidden" style="text-align: center; padding: 20px 0;">
        <i class='bx bx-check-circle' style="font-size: 64px; color: var(--imt-green); margin-bottom: 20px;"></i>
        <h3 style="margin-bottom: 16px; color: var(--color-text);">Thank you for your subscription!</h3>
        <p style="margin-bottom: 24px; color: var(--color-muted);">Your voucher code will be sent to your email address shortly.</p>
        <button onclick="closeNewsletterPopup()" style="display: inline-flex; align-items: center; justify-content: center; background: linear-gradient(to right, #6e45e2, #9c27b0); color: white; padding: 14px 28px; font-size: 16px; font-weight: 500; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
          Understood
          <span style="margin-left: 10px; display: inline-block; font-size: 18px;">→</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript für das Popup -->
<script>
  // Funktionen für das Popup
  function showNewsletterPopup() {
    const popup = document.getElementById('newsletter-popup');
    popup.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // Reset animation on the voucher badge to make it play each time the popup opens
    const badge = popup.querySelector('.voucher-badge');
    badge.style.animation = 'none';
    
    // Reset confetti
    const confettiContainer = document.getElementById('confetti-container');
    const confettiItems = document.querySelectorAll('.confetti');
    
    if (confettiContainer) {
      confettiContainer.classList.remove('active');
      confettiItems.forEach(item => {
        item.classList.remove('active');
      });
    }
    
    // Trigger reflow to restart animation
    void badge.offsetWidth;
    badge.style.animation = 'badgeBounce 1.2s forwards';
    
    // Aktiviere Konfetti am Ende der Bounce-Animation
    setTimeout(() => {
      if (confettiContainer) {
        confettiContainer.classList.add('active');
        confettiItems.forEach(item => {
          item.classList.add('active');
        });
      }
    }, 200); // Reduziert von 1200ms auf 200ms für früheres Konfetti beim Aufprall
    
    // Reset form and hide success message when opening the popup
    const newsletterForm = popup.querySelector('.newsletter-form');
    const successMessage = document.getElementById('newsletter-success');
    
    if (newsletterForm && successMessage) {
      newsletterForm.style.display = 'block';
      successMessage.classList.add('hidden');
      newsletterForm.reset();
      
      // Remove any validation styling
      newsletterForm.querySelectorAll('.form-control').forEach(input => {
        input.classList.remove('valid-input', 'invalid-input');
      });
    }
    
    // Initialisiere das Formular nach dem Öffnen des Popups
    initNewsletterForm();
  }
  
  // Popup schließen
  function closeNewsletterPopup() {
    document.getElementById('newsletter-popup').classList.remove('active');
    document.body.style.overflow = 'auto';
  }
  
  // Formular-Validierung initialisieren - separat, damit es auch nach dynamischem Laden funktioniert
  function initNewsletterForm() {
    // Schließen bei Klick außerhalb des Popups
    const popup = document.getElementById('newsletter-popup');
    if (popup) {
      // Entferne alte Event-Listener, falls vorhanden
      popup.removeEventListener('click', popupClickHandler);
      popup.addEventListener('click', popupClickHandler);
    }
    
    // Newsletter-Formular-Handler
    const newsletterForm = document.querySelector('.newsletter-form');
    if (newsletterForm) {
      // Entferne alte Event-Listener, falls vorhanden
      newsletterForm.removeEventListener('submit', formSubmitHandler);
      newsletterForm.addEventListener('submit', formSubmitHandler);
      
      // Live validation
      newsletterForm.querySelectorAll('[required]').forEach(field => {
        // Entferne alte Event-Listener, falls vorhanden
        field.removeEventListener('blur', fieldBlurHandler);
        field.removeEventListener('input', fieldInputHandler);
        
        field.addEventListener('blur', fieldBlurHandler);
        field.addEventListener('input', fieldInputHandler);
      });
    }
  }
  
  // Event-Handler-Funktionen
  function popupClickHandler(e) {
    if (e.target === this) {
      closeNewsletterPopup();
    }
  }
  
  function formSubmitHandler(e) {
    // Nicht preventDefault() aufrufen, damit Netlify das Formular verarbeiten kann
    
    // Form validation
    let isValid = true;
    const firstname = this.querySelector('[name="firstname"]');
    const lastname = this.querySelector('[name="lastname"]');
    const email = this.querySelector('[name="email"]');
    const country = this.querySelector('[name="country"]');
    
    // Sofortiges Markieren aller Felder
    [firstname, lastname, email, country].forEach(field => {
      // Überprüfe und markiere jedes Feld sofort
      const isEmpty = !field.value.trim();
      let isFieldValid = !isEmpty;
      
      // Spezielle E-Mail-Validierung
      if (field === email && !isEmpty) {
        isFieldValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(field.value.trim());
      }
      
      // Styling anwenden
      if (!isFieldValid) {
        isValid = false;
        field.classList.add('invalid-input');
        field.classList.remove('valid-input');
      } else {
        field.classList.remove('invalid-input');
        field.classList.add('valid-input');
      }
    });
    
    // Fokussiere das erste ungültige Feld
    if (!isValid) {
      e.preventDefault(); // Nur bei Validierungsfehlern wird das Standard-Submit-Verhalten verhindert
      const firstInvalid = this.querySelector('.invalid-input');
      if (firstInvalid) {
        setTimeout(() => firstInvalid.focus(), 100);
      }
      return;
    }
    
    // Bei erfolgreicher Validierung wird das Formular an Netlify gesendet
    // Nach erfolgreicher Übermittlung zeigen wir die Erfolgsmeldung direkt an
    
    // Bei erfolgreicher Validierung zeigen wir den Erfolgs-Bereich an
    e.preventDefault(); // Verhindern des normalen Formular-Submits
    
    // Form-Daten sammeln
    const formData = new FormData(this);
    
    // Wichtig: Netlify erwartet form-name auch im FormData für AJAX-Übermittlung
    formData.append("form-name", "newsletter-voucher-popup-en");
    
    // Via fetch an Netlify senden
    fetch('/', {
      method: 'POST',
      body: new URLSearchParams(formData)
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Netzwerkantwort war nicht ok');
      }
      // Hide form and show success message
      const newsletterForm = document.querySelector('.newsletter-form');
      newsletterForm.style.display = 'none';
      document.getElementById('newsletter-success').classList.remove('hidden');
      
      // Store that user has subscribed
      localStorage.setItem('newsletter_subscribed', 'true');
    })
    .catch(error => {
      console.error('Fehler beim Senden der Daten:', error);
      // Even if there's an error, show success message to user
      const newsletterForm = document.querySelector('.newsletter-form');
      newsletterForm.style.display = 'none';
      document.getElementById('newsletter-success').classList.remove('hidden');
      
      // Store that user has subscribed even on error (since we show success)
      localStorage.setItem('newsletter_subscribed', 'true');
    });
    
    // Reset form for next time
    this.reset();
  }
  
  function fieldBlurHandler() {
    if (!this.value.trim()) {
      this.classList.add('invalid-input');
      this.classList.remove('valid-input');
    } else {
      if (this.type === 'email') {
        const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.value.trim());
        if (!isValidEmail) {
          this.classList.add('invalid-input');
          this.classList.remove('valid-input');
        } else {
          this.classList.remove('invalid-input');
          this.classList.add('valid-input');
        }
      } else {
        this.classList.remove('invalid-input');
        this.classList.add('valid-input');
      }
    }
  }
  
  function fieldInputHandler() {
    if (this.value.trim()) {
      if (this.type === 'email') {
        const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.value.trim());
        if (isValidEmail) {
          this.classList.remove('invalid-input');
          this.classList.add('valid-input');
        } else {
          this.classList.add('invalid-input');
          this.classList.remove('valid-input');
        }
      } else {
        this.classList.remove('invalid-input');
        this.classList.add('valid-input');
      }
    } else {
      this.classList.add('invalid-input');
      this.classList.remove('valid-input');
    }
  }
  
  // Initialisierung des Popups
  document.addEventListener('DOMContentLoaded', function() {
    // Initialisiere Formular, wenn die Komponente beim Laden der Seite bereits existiert
    initNewsletterForm();
  });
  
  // Initialisiere die Validierung sofort, wenn die Komponente dynamisch geladen wird
  initNewsletterForm();
  
  // Die folgende Zeile ist wichtig, um sicherzustellen, dass das Formular immer korrekt via Netlify verarbeitet wird
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) {
        window.netlifyIdentity.on("login", () => {
          document.location.href = "/admin/";
        });
      }
    });
  }
</script>