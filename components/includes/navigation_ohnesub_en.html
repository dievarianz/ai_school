<!-- ============ NAVIGATION WITHOUT SUBNAVIGATION ============ -->
<!-- 
  This component serves as the central navigation for all pages of the website.
  Unlike navigation.html, this one lacks the subnavigation for tracks.
  
  To use this component, there are two options:
  
  1. For HTML files with PHP support:
     <?php include('components/globals/navigation_ohnesub_en.html'); ?>
  
  2. For pure HTML files with JavaScript:
     <div id="navigation-container"></div>
     <script>
       fetch('components/globals/navigation_ohnesub_en.html')
         .then(response => response.text())
         .then(data => {
           document.getElementById('navigation-container').innerHTML = data;
         });
     </script>
  
  Changes to this file will be automatically applied to all pages
  that include this component.
-->

<div class="nav-wrapper">
  <nav class="main-nav">
    <div class="nav-container">
      <a href="index_en.html" class="nav-logo" data-base-href="index_en.html">
        <img src="assets/pictures/imt_logo.png" alt="StGallen Integrated imt Business School">
      </a>
      
      <div class="nav-menu" id="mobileNavMenu">
        <!-- Mobile language section - now at the top -->
        <div class="mobile-lang-section">
          <div class="lang-title">Language</div>
          <div class="mobile-lang-options">
            <a href="#" class="mobile-lang-option" data-lang="de" onclick="switchLanguage('de', event)"><img src="assets/icons/de-flag-round.png" alt="Deutsch" class="lang-flag-mobile" /> Deutsch</a>
            <a href="#" class="mobile-lang-option active" data-lang="en" onclick="switchLanguage('en', event)"><img src="assets/icons/en-flag-round.png" alt="English" class="lang-flag-mobile" /> English</a>
          </div>
        </div>

        <a href="index_en.html" class="nav-link" data-base-href="index_en.html">StGallen imt</a>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="mobileMenuToggle(event, this)">Executive Education<svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
          <div class="program-dropdown" id="mobile-program-dropdown" style="display: none;">
            <!-- First column: Individual seminars -->
            <div class="menu-column">
              <h3>Management Seminars</h3>
              <a href="integrated_management_strategy_en.html" class="program-option" id="integrated-management-option" data-base-href="integrated_management_strategy_en.html" data-parent-folder="managementseminare">Integrated Management and Strategy</a>
              <a href="financial_management_en.html" class="program-option" id="financial-management-option" data-base-href="financial_management_en.html" data-parent-folder="managementseminare">Financial Management</a>
              <a href="inspirational_leadership_en.html" class="program-option" id="inspirational-leadership-option" data-base-href="inspirational_leadership_en.html" data-parent-folder="managementseminare">Inspirational Leadership</a>
              <a href="marketing_sales_brand_communication_en.html" class="program-option" id="marketing-sales-option" data-base-href="marketing_sales_brand_communication_en.html" data-parent-folder="managementseminare">Marketing, Sales and Brand Communication</a>
              <a href="intelligent_process_automation_en.html" class="program-option" id="process-automation-option" data-base-href="intelligent_process_automation_en.html" data-parent-folder="managementseminare">Intelligent Process Automation</a>
              <a href="ai_augmented_decision_making_en.html" class="program-option" id="ai-decision-making-option" data-base-href="ai_augmented_decision_making_en.html" data-parent-folder="managementseminare">AI-Augmented Decision Making</a>
            </div>
            
            <!-- Second column: Programs -->
            <div class="menu-column">
              <h3>Programs</h3>
              <a href="management_programm_en.html" class="program-option" data-base-href="management_programm_en.html">StGallen Management Program</a>
              <a href="management_programm_cas_en.html" class="program-option" data-base-href="management_programm_cas_en.html">StGallen Certified Management CAS</a>
              <a href="ai_excellence_programm_en.html" class="program-option" data-base-href="ai_excellence_programm_en.html">StGallen AI Excellence Management Program</a>
              <a href="fast_track_mba_en.html" class="program-option" data-base-href="fast_track_mba_en.html">StGallen Fast Track MBA Program</a>
            </div>
          </div>
        </div>
        <a href="research_en.html" class="nav-link" data-base-href="research_en.html">Research</a>
        <a href="netzwerk_en.html" class="nav-link" data-base-href="netzwerk_en.html">Network</a>
        <a href="support_en.html" class="nav-link" data-base-href="support_en.html">Support</a>
        <a href="kontakt_en.html" class="nav-link" data-base-href="kontakt_en.html">Contact</a>
      </div>
      
      <div class="lang-select">
        <a href="#" class="nav-link"><img src="assets/icons/en-flag-round.png" alt="English" class="lang-flag-nav" /> EN <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
        <div class="program-dropdown lang-dropdown">
          <a href="#" id="lang-de-link" class="program-option" data-lang="de"><img src="assets/icons/de-flag-round.png" alt="Deutsch" class="lang-flag" /> Deutsch</a>
          <a href="#" id="lang-en-link" class="program-option active" data-lang="en"><img src="assets/icons/en-flag-round.png" alt="English" class="lang-flag" /> English</a>
        </div>
      </div>
      
      <button class="mobile-menu-btn" id="mobileMenuButton">
        <div class="hamburger-icon">
          <span class="line line-1"></span>
          <span class="line line-2"></span>
          <span class="line line-3"></span>
        </div>
      </button>
    </div>
  </nav>
</div>

<style>
  :root {
    --font-sans: -apple-system,BlinkMacSystemFont,"San Francisco","Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;
    --color-text: #1d1d1f;
    --color-muted: #6e6e73;
    --color-card-bg: #f5f5f7;
    --color-accent2: #970289;
    --color-badge: #e2b245;
    --color-badge-hover: #d4a535;
    --spacing: 24px;
    --radius: 16px;
    --max-width: 1200px;
    --imt-purple: #6e45e2;
  }

  /* Navigation Wrapper and Container */
  .nav-wrapper {
    position: fixed;
    left: 0;
    right: 0;
    top: 0;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 1000;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    font-family: var(--font-sans);
    color: var(--color-text);
  }

  .nav-container {
    max-width: var(--max-width);
    width: 90%;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 60px;
    padding: 0;
    position: relative;
  }

  /* Fix for language display in English version */
  .nav-container > .Language,
  .nav-container > .Deutsch,
  .nav-container > .English {
    display: none !important;
  }
  
  .mobile-lang-section {
    display: none;
  }
  
  /* Make sure mobile language section only appears in mobile view */
  @media (max-width: 1024px) {
    .mobile-lang-section {
      display: block !important;
      width: 100%;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
  }
  /* End of fix */

  /* Main Navigation */
  .main-nav {
    background: #fff;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    width: 100%;
  }

  .nav-logo {
    display: flex;
    align-items: center;
    margin-right: auto;
    height: 26px;
  }

  .nav-logo img {
    height: 100%;
    width: auto;
  }

  .nav-menu {
    display: flex;
    align-items: center;
    gap: 32px;
    margin-right: 0;
  }

  .nav-link {
    color: var(--color-text);
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: 500;
    white-space: nowrap;
    position: relative;
    padding: 8px 0;
    transition: color 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .nav-link svg {
    margin-left: 2px;
    transition: transform 0.2s ease;
  }

  .nav-link:hover {
    color: var(--color-accent2);
    text-decoration: none !important;
  }

  .nav-link.active {
    color: var(--color-accent2);
    text-decoration: none !important;
  }

  /* Prevents underlining of all navigation links */
  .nav-menu a:hover {
    text-decoration: none !important;
  }

  .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--color-accent2);
    border-radius: 1px;
  }

  .nav-item:hover .nav-link svg, 
  .lang-select:hover .nav-link svg {
    transform: rotate(180deg);
  }

  /* Dropdown */
  .nav-item {
    position: relative;
  }

  .program-dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(-8px);
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    padding: 24px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    min-width: 850px;
    margin-top: 8px;
    z-index: 1000;
    display: flex;
    gap: 24px;
  }

  .nav-item:hover .program-dropdown,
  .lang-select:hover .program-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(0);
  }
  
  /* Columns for seminars and programs */
  .menu-column {
    flex: 1;
  }

  .menu-column h3 {
    font-size: 1rem;
    margin-bottom: 16px;
    color: var(--color-accent2);
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }
  
  /* Teal color for Programs heading */
  .menu-column:nth-child(2) h3 {
    color: #17a689;
  }

  /* Style rules for all program options */
  .program-option {
    display: block;
    padding: 12px 16px;
    color: var(--color-text);
    text-decoration: none;
    font-size: 0.95rem;
    border-radius: 8px;
    transition: all 0.2s ease;
    line-height: 1.4;
    margin-bottom: 4px;
  }

  .program-option:hover {
    background: var(--color-card-bg);
    color: var(--color-accent2);
  }
  
  /* Teal color for Program options on hover */
  .menu-column:nth-child(2) .program-option:hover {
    color: #17a689;
  }
  
  /* Specially marked option - directly in the HTML definition */
  .highlight-option {
    font-weight: 600;
    background-color: var(--color-card-bg);
    color: var(--color-accent2);
    border-left: 4px solid var(--color-accent2);
    padding-left: 12px;
    border-radius: 0 8px 8px 0; /* Only right side rounded */
  }
  
  /* Options for language selection */
  .lang-dropdown .program-option.active {
    font-weight: 600;
    background-color: var(--color-card-bg);
    color: var(--color-accent2);
    border-left: none;
    padding-left: 16px;
    border-radius: 8px;
  }

  /* Language Selector */
  .lang-select {
    margin-left: 32px;
    position: relative;
  }

  .lang-dropdown {
    right: -16px;
    left: auto;
    min-width: 140px;
    transform: none !important;
    display: block !important;
    padding: 8px !important;
  }

  .lang-select:hover .program-dropdown {
    transform: translateY(0) !important;
  }

  /* Hide the text "Sprache Deutsch English" in the non-mobile version */
  .nav-container .lang-select + .sprache-text,
  .nav-container .lang-select ~ .sprache-text,
  .nav-container .sprache-text,
  .nav-container > div:last-child:not(.lang-select):not(.mobile-menu-btn),
  .nav-container > div:last-child:not(.lang-select):not(.mobile-menu-btn) .Sprache,
  a[href="#"] + .Sprache,
  .Sprache {
    display: none !important;
  }

  /* Mobile Menu Button - FIX */
  .mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
    color: var(--color-text);
    font-size: 24px;
    position: relative;
    z-index: 1100;
  }
  
  /* Hamburger Icon Styles */
  .hamburger-icon {
    width: 24px;
    height: 24px;
    position: relative;
  }

  .hamburger-icon .line {
    display: block;
    position: absolute;
    width: 100%;
    height: 2px;
    background-color: var(--color-text);
    border-radius: 2px;
    transition: all 0.3s ease;
    left: 0;
    transform-origin: center;
  }

  .hamburger-icon .line-1 {
    top: 5px;
  }

  .hamburger-icon .line-2 {
    top: 11px;
  }

  .hamburger-icon .line-3 {
    top: 17px;
  }

  /* X-Icon Transformation when menu is active */
  .nav-menu.active ~ .mobile-menu-btn .hamburger-icon .line-1 {
    top: 11px;
    transform: rotate(45deg);
  }

  .nav-menu.active ~ .mobile-menu-btn .hamburger-icon .line-2 {
    opacity: 0;
  }

  .nav-menu.active ~ .mobile-menu-btn .hamburger-icon .line-3 {
    top: 11px;
    transform: rotate(-45deg);
  }
  
  /* Make sure it appears at mobile sizes */
  @media (max-width: 1024px) {
    .mobile-menu-btn {
      display: block !important;
    }
  }

  /* Mobile Styles completely revised */
  @media (max-width: 1024px) {
    .nav-container {
      position: sticky;
      top: 0;
      background: white;
      z-index: 1020;
    }
    
    .nav-menu {
      position: fixed;
      top: 64px;
      left: 0;
      width: 100%;
      height: calc(100vh - 64px);
      background: white;
      flex-direction: column;
      align-items: flex-start;
      padding: 20px;
      gap: 20px;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
      z-index: 1000;
    }
    
    .nav-menu.active {
      transform: translateX(0);
    }
    
    .nav-item {
      width: 100%;
    }
    
    /* Single selector with maximum specificity */
    #mobile-program-dropdown.visible {
      display: block !important;
      position: static !important;
      opacity: 1 !important;
      visibility: visible !important;
      transform: none !important;
      margin: 8px 0 !important;
      box-shadow: none !important;
      border-radius: 8px !important;
      background-color: #f5f5f7 !important;
      width: 100% !important;
      min-width: auto !important;
    }
    
    /* Language switcher always visible in mobile */
    .mobile-lang-section {
      display: block !important;
      width: 100%;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    /* Hide desktop language selector in mobile view */
    .lang-select {
      display: none !important;
    }
  }
  
  /* Fix mobile language section */
  .mobile-lang-section {
    width: 100%;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .lang-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--color-text);
  }
  
  .mobile-lang-options {
    display: flex;
    gap: 16px;
  }
  
  .mobile-lang-option {
    padding: 8px 16px;
    background: var(--color-card-bg);
    border-radius: 8px;
    color: var(--color-text);
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.2s ease;
  }
  
  .mobile-lang-option.active {
    background: var(--color-accent2);
    color: white;
    font-weight: 500;
  }
  
  /* Hide mobile language section in desktop view */
  @media (min-width: 1025px) {
    .mobile-lang-section {
      display: none !important;
    }
  }

  /* Swiss Flag Mini */
  .swiss-flag-mini {
    position: relative;
    width: 24px;
    height: 24px;
    background-color: var(--swiss-red);
    border-radius: 2px;
    margin-left: 6px;
  }
  
  .swiss-flag-mini::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    background-color: white;
    border-radius: 2px;
  }

  /* Ensure mobile language section is visible in mobile view */
  @media (max-width: 1024px) {
    .mobile-lang-section {
      display: block !important;
      width: 100%;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    /* Fix for mobile dropdown in the English version */
    .mobile-dropdown {
      display: none;
      position: static !important;
      transform: none !important;
      opacity: 1 !important;
      visibility: visible !important;
      box-shadow: none !important;
      width: 100% !important;
      min-width: 100% !important;
      margin-top: 8px;
      margin-bottom: 8px;
      border-radius: 8px;
      background-color: var(--color-card-bg);
    }
    
    .mobile-dropdown.show {
      display: block !important;
    }
    
    /* Prevent hover effects from interfering with mobile */
    .nav-item:hover .program-dropdown {
      display: none;
      opacity: 0;
      visibility: hidden;
    }
  }

  /* DIRECT MOBILE STYLES - NEW */
  @media (max-width: 1024px) {
    /* Mobile Dropdown fixes */
    .mobile-dropdown {
      display: none !important;
      transition: none !important;
      animation: none !important;
    }
    
    .mobile-dropdown.show-mobile {
      display: block !important;
    }
    
    /* Mobile Nav Link */
    .mobile-toggle {
      position: relative;
      z-index: 10;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* 100% certain that hover is disabled */
    .nav-item:hover .program-dropdown,
    .nav-item:focus .program-dropdown,
    .nav-item:focus-within .program-dropdown {
      opacity: 0 !important;
      visibility: hidden !important;
      display: none !important;
    }
    
    /* Language Switcher always visible */
    .mobile-lang-section {
      display: block !important;
    }
  }

  /* Language Flag Icons */
  .lang-flag {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    margin-right: 8px;
    vertical-align: middle;
    object-fit: cover;
    border: none;
    display: inline-block;
  }
  
  .lang-flag-mobile {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    margin-right: 6px;
    vertical-align: middle;
    object-fit: cover;
    border: none;
    display: inline-block;
  }
  
  .lang-flag-nav {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    margin-right: 4px;
    vertical-align: middle;
    object-fit: cover;
    border: none;
    display: inline-block;
  }
  
  /* Align flag with text in language dropdown */
  .lang-dropdown .program-option {
    display: flex;
    align-items: center;
  }

  /* Align flag with text in mobile language options */
  .mobile-lang-option, .only-mobile-lang-option {
    display: flex;
    align-items: center;
  }

  /* Align flag with language in top nav */
  .nav-link img + svg,
  .nav-link img {
    display: inline-block;
    vertical-align: middle;
  }
  
  /* Improve lang-select nav alignment */
  .lang-select .nav-link {
    display: flex;
    align-items: center;
  }
</style>

<!-- Extremely simple JavaScript -->
<script>
  // Direct language switching function
  function switchLanguage(lang, event) {
    event.preventDefault();
    
    // Get current page path
    const currentPath = window.location.pathname;
    const currentPage = currentPath.substring(currentPath.lastIndexOf('/') + 1);
    const currentSearch = window.location.search || '';
    
    // Determine target page
    let targetPage;
    if (lang === 'de' && currentPage.includes('_en.html')) {
      // Switch from English to German
      targetPage = currentPage.replace('_en.html', '.html');
      window.location.href = targetPage + currentSearch;
    } else if (lang === 'en' && !currentPage.includes('_en.html')) {
      // Switch from German to English
      targetPage = currentPage.replace('.html', '_en.html');
      window.location.href = targetPage + currentSearch;
    }
  }
  
  // Global variable to track menu status
  var programMenuOpen = false;
  
  // Simple toggle function for mobile menu
  function toggleMobileMenu() {
    const navMenu = document.getElementById('mobileNavMenu');
    if (navMenu) {
      navMenu.classList.toggle('active');
      
      // When menu is toggled, make sure language options are visible and correctly set up
      if (navMenu.classList.contains('active')) {
        const langSection = document.querySelector('.mobile-lang-section');
        if (langSection) {
          // Set display explicitly to ensure visibility
          langSection.style.display = 'block';
          
          // Update links
          updateMobileLanguageSwitcher();
        }
      } else {
        // Reset program menu when closing
        const dropdown = document.getElementById('mobile-program-dropdown');
        if (dropdown) {
          dropdown.style.display = 'none';
          dropdown.classList.remove('visible');
          if (typeof programMenuOpen !== 'undefined') {
            programMenuOpen = false;
          }
        }
      }
    }
  }
  
  // Programs toggle for mobile - if this function exists
  if (typeof mobileMenuToggle !== 'function') {
    function mobileMenuToggle(event, element) {
      // Only in mobile view
      if (window.innerWidth <= 1024) {
        event.preventDefault();
        
        // Get dropdown element
        const dropdown = document.getElementById('mobile-program-dropdown');
        
        // Toggle status
        window.programMenuOpen = !window.programMenuOpen;
        
        // Set display directly
        if (window.programMenuOpen) {
          dropdown.style.display = 'block';
          dropdown.classList.add('visible');
        } else {
          dropdown.style.display = 'none';
          dropdown.classList.remove('visible');
        }
      }
    }
  }
  
  // On page load
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize language switching
    setupLanguageSwitching();
    monitorMobileMenu();
    
    // Explicitly make sure mobile language section is properly initialized
    updateMobileLanguageSwitcher();
    
    // Add IDs to the language links if they don't exist
    const languageLinks = document.querySelectorAll('.lang-dropdown .program-option');
    if (languageLinks.length >= 2) {
      if (!languageLinks[0].id) languageLinks[0].id = 'lang-de-link';
      if (!languageLinks[1].id) languageLinks[1].id = 'lang-en-link';
      
      // Update href attributes to use proper language switching
      languageLinks[0].setAttribute('data-lang', 'de');
      languageLinks[1].setAttribute('data-lang', 'en');
    }

    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
      if (window.innerWidth <= 1024) {
        const navItem = e.target.closest('.nav-item');
        const dropdown = document.getElementById('mobile-program-dropdown');
        
        // If we click outside and menu is open
        if (!navItem && window.programMenuOpen && dropdown) {
          dropdown.style.display = 'none';
          dropdown.classList.remove('visible');
          window.programMenuOpen = false;
        }
      }
    });
    
    // Adjust paths based on directory structure
    adjustNavigationPaths();
  });
</script>

<!-- Path correction script -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Detect page location and fix paths
    const currentPath = window.location.pathname;
    const inManagementSeminarFolder = currentPath.includes('/managementseminare/');
    
    // Only adjust links if we're in the managementseminare folder
    if (inManagementSeminarFolder) {
      // Fix managementseminare links by removing the folder prefix
      document.querySelectorAll('.menu-column a[href^="managementseminare/"]').forEach(link => {
        const originalHref = link.getAttribute('href');
        // Extract just the filename
        const fileName = originalHref.replace('managementseminare/', '');
        // Set the correct relative path
        link.setAttribute('href', fileName);
      });
      
      // Fix main navigation links to point back up one level
      document.querySelectorAll('.nav-menu > a:not(.toggle-subnav)').forEach(link => {
        const originalHref = link.getAttribute('href');
        if (originalHref && !originalHref.startsWith('#') && !originalHref.startsWith('http')) {
          link.setAttribute('href', '../' + originalHref);
        }
      });
      
      // Fix the logo link to point to homepage
      const logoLink = document.querySelector('.nav-logo');
      if (logoLink) {
        logoLink.setAttribute('href', '../index_en.html');
      }
    }
  });
</script>

<!-- Script for language switching -->
<script>
  function setupLanguageSwitching() {
    // Get current page information
    const currentPath = window.location.pathname;
    const currentPage = currentPath.substring(currentPath.lastIndexOf('/') + 1);
    
    // Check if we're on an English or German page
    const isEnglish = currentPage.includes('_en');
    
    // Find desktop language selection links
    const deLinkDesktop = document.getElementById('lang-de-link');
    const enLinkDesktop = document.getElementById('lang-en-link');
    
    if (deLinkDesktop && enLinkDesktop) {
      // First remove active class from both
      deLinkDesktop.classList.remove('active');
      enLinkDesktop.classList.remove('active');
      
      // Set correct target link for German
      if (isEnglish) {
        // From English to German: page_en.html -> page.html
        const germanPage = currentPage.replace('_en.html', '.html');
        deLinkDesktop.setAttribute('href', germanPage);
        
        // Add click handler to store language preference
        deLinkDesktop.addEventListener('click', function() {
          sessionStorage.setItem('preferredLanguage', 'de');
        });
      } else {
        // Already on German, disable link
        deLinkDesktop.classList.add('active');
        deLinkDesktop.setAttribute('href', '#');
      }
      
      // Set correct target link for English
      if (!isEnglish) {
        // From German to English: page.html -> page_en.html
        const englishPage = currentPage.replace('.html', '_en.html');
        enLinkDesktop.setAttribute('href', englishPage);
        
        // Add click handler to store language preference
        enLinkDesktop.addEventListener('click', function() {
          sessionStorage.setItem('preferredLanguage', 'en');
        });
      } else {
        // Already on English, disable link
        enLinkDesktop.classList.add('active');
        enLinkDesktop.setAttribute('href', '#');
      }
    }
    
    // Find mobile language selection links
    const mobileLanguageOptions = document.querySelectorAll('.mobile-lang-option');
    
    mobileLanguageOptions.forEach(link => {
      const lang = link.getAttribute('data-lang');
      
      // First remove all active classes
      link.classList.remove('active');
      
      // Mark current language
      if ((lang === 'en' && isEnglish) || (lang === 'de' && !isEnglish)) {
        link.classList.add('active');
      }
      
      // Set correct target link
      if (lang === 'en' && !isEnglish) {
        // From German to English
        const englishPage = currentPage.replace('.html', '_en.html');
        link.setAttribute('href', englishPage);
        
        // Add click handler to store language preference
        link.addEventListener('click', function() {
          sessionStorage.setItem('preferredLanguage', 'en');
        });
      } else if (lang === 'de' && isEnglish) {
        // From English to German
        const germanPage = currentPage.replace('_en.html', '.html');
        link.setAttribute('href', germanPage);
        
        // Add click handler to store language preference
        link.addEventListener('click', function() {
          sessionStorage.setItem('preferredLanguage', 'de');
        });
      } else {
        // Stay on same language
        link.setAttribute('href', '#');
      }
    });
  }
  
  // Monitor the mobile menu and update language selection when opened
  function monitorMobileMenu() {
    // Find the mobile menu button and nav menu
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const navMenu = document.querySelector('.nav-menu');
    
    // If the button exists, add an event handler
    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', function() {
        // Toggle the active class on the menu
        navMenu.classList.toggle('active');
        
        // Short delay to ensure the mobile-lang-section is inserted
        setTimeout(function() {
          const mobileLangOptions = document.querySelectorAll('.mobile-lang-option');
          
          // If options are found, update the links
          if (mobileLangOptions.length > 0) {
            // Get current page information
            const currentPath = window.location.pathname;
            const currentPage = currentPath.substring(currentPath.lastIndexOf('/') + 1);
            const isEnglish = currentPage.includes('_en');
            
            mobileLangOptions.forEach(link => {
              const lang = link.getAttribute('data-lang');
              
              // Mark current language
              if ((lang === 'en' && isEnglish) || (lang === 'de' && !isEnglish)) {
                link.classList.add('active');
              } else {
                link.classList.remove('active');
              }
              
              // Set correct target link
              if (lang === 'en' && !isEnglish) {
                // From German to English
                const englishPage = currentPage.replace('.html', '_en.html');
                link.setAttribute('href', englishPage);
                
                // Add click handler to store language preference
                link.addEventListener('click', function() {
                  sessionStorage.setItem('preferredLanguage', 'en');
                });
              } else if (lang === 'de' && isEnglish) {
                // From English to German
                const germanPage = currentPage.replace('_en.html', '.html');
                link.setAttribute('href', germanPage);
                
                // Add click handler to store language preference
                link.addEventListener('click', function() {
                  sessionStorage.setItem('preferredLanguage', 'de');
                });
              } else {
                // Stay on same language
                link.setAttribute('href', '#');
              }
            });
          }
        }, 100);
      });
    }
  }
  
  // Function to ensure mobile language switcher is properly initialized and visible
  function updateMobileLanguageSwitcher() {
    const langSection = document.querySelector('.mobile-lang-section');
    if (langSection) {
      // Force display
      langSection.style.display = 'block';
      
      // Setup language links
      const currentPage = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
      const isEnglish = currentPage.includes('_en');
      
      const langLinks = langSection.querySelectorAll('.mobile-lang-option');
      langLinks.forEach(link => {
        const lang = link.getAttribute('data-lang');
        
        // Clear active state
        link.classList.remove('active');
        
        // Set active state based on current page
        if ((lang === 'en' && isEnglish) || (lang === 'de' && !isEnglish)) {
          link.classList.add('active');
        }
        
        // Set proper destination URLs
        if (lang === 'en' && !isEnglish) {
          const englishPage = currentPage.replace('.html', '_en.html');
          link.setAttribute('href', englishPage);
        } else if (lang === 'de' && isEnglish) {
          const germanPage = currentPage.replace('_en.html', '.html');
          link.setAttribute('href', germanPage);
        } else {
          link.setAttribute('href', '#');
        }
      });
    }
  }
</script>

<!-- Completely revised Mobile Navigation -->
<script>
  // Global variable to track if we're in mobile or desktop view
  let isMobileView = window.innerWidth <= 1024;
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize navigation based on viewport size
    updateNavigationMode();
    
    // Language setup
    setupLanguageSwitching();
    
    // Window resize event for responsive adjustment
    window.addEventListener('resize', function() {
      const wasMobile = isMobileView;
      isMobileView = window.innerWidth <= 1024;
      
      // Only if the mode changes
      if (wasMobile !== isMobileView) {
        updateNavigationMode();
      }
    });
  });
  
  // Update based on Mobile/Desktop
  function updateNavigationMode() {
    if (isMobileView) {
      setupMobileNavigation();
    } else {
      cleanupMobileNavigation();
    }
  }
  
  // Mobile Menu Toggle
  function toggleMobileMenu() {
    if (isMobileView) {
      const navMenu = document.getElementById('mobileNavMenu');
      if (navMenu) {
        navMenu.classList.toggle('active');
      }
    }
  }
  
  // Mobile-specific setup
  function setupMobileNavigation() {
    // Find mobile toggles
    const mobileToggles = document.querySelectorAll('.mobile-toggle');
    
    // Add click handlers
    mobileToggles.forEach(toggle => {
      // Remove existing handlers to avoid duplicates
      toggle.removeEventListener('click', handleMobileToggleClick);
      // Add handler
      toggle.addEventListener('click', handleMobileToggleClick);
    });
  }
  
  // Click handler for Mobile Toggle
  function handleMobileToggleClick(e) {
    if (isMobileView) {
      e.preventDefault();
      e.stopPropagation();
      
      // Find dropdown
      const dropdown = this.closest('.nav-item').querySelector('.program-dropdown');
      
      // Close all other dropdowns
      document.querySelectorAll('.program-dropdown.show-mobile').forEach(d => {
        if (d !== dropdown) {
          d.classList.remove('show-mobile');
        }
      });
      
      // Toggle this dropdown
      if (dropdown) {
        dropdown.classList.toggle('show-mobile');
      }
    }
  }
  
  // Cleanup for Desktop mode
  function cleanupMobileNavigation() {
    // Remove mobile-specific classes
    document.querySelectorAll('.program-dropdown.show-mobile').forEach(dropdown => {
      dropdown.classList.remove('show-mobile');
    });
    
    // Close mobile menu
    const navMenu = document.getElementById('mobileNavMenu');
    if (navMenu && navMenu.classList.contains('active')) {
      navMenu.classList.remove('active');
    }
  }
  
  // Ensure the language switcher is properly initialized
  function updateMobileLanguageSwitcher() {
    const langSection = document.querySelector('.mobile-lang-section');
    if (langSection) {
      const currentPage = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
      const isEnglish = currentPage.includes('_en');
      
      const langLinks = langSection.querySelectorAll('.mobile-lang-option');
      langLinks.forEach(link => {
        const lang = link.getAttribute('data-lang');
        
        // Clear active state
        link.classList.remove('active');
        
        // Set active state based on current page
        if ((lang === 'en' && isEnglish) || (lang === 'de' && !isEnglish)) {
          link.classList.add('active');
        }
        
        // Set proper URLs
        if (lang === 'en' && !isEnglish) {
          const englishPage = currentPage.replace('.html', '_en.html');
          link.setAttribute('href', englishPage);
        } else if (lang === 'de' && isEnglish) {
          const germanPage = currentPage.replace('_en.html', '.html');
          link.setAttribute('href', germanPage);
        } else {
          link.setAttribute('href', '#');
        }
      });
    }
  }
  
  // Add global document click handler to close dropdowns
  document.addEventListener('click', function(e) {
    if (isMobileView) {
      // Only if we're not clicking on a toggle or inside a dropdown
      if (!e.target.closest('.mobile-toggle') && !e.target.closest('.program-dropdown')) {
        // Close all dropdowns
        document.querySelectorAll('.program-dropdown.show-mobile').forEach(dropdown => {
          dropdown.classList.remove('show-mobile');
        });
      }
    }
  });
</script> 